<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Robot Control Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" />
    <style>
        body {
            margin: 0;
            font-family: sans-serif;
            background: linear-gradient(to bottom right, #f8fafc, #f1f5f9);
        }

        .container {
            max-width: 1200px;
            margin: auto;
            padding: 1.5rem;
        }

        .header {
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: bold;
            color: #0f172a;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header p {
            color: #475569;
        }

        .tabs-list {
            display: flex;
            max-width: 400px;
            margin-bottom: 1rem;
        }

        .tabs-trigger {
            flex: 1;
            padding: 0.75rem;
            text-align: center;
            cursor: pointer;
            border: 1px solid #cbd5e1;
            background: white;
        }

        .tabs-trigger.active {
            background: #e2e8f0;
        }

        .card {
            width: 50%;
            border: 1px solid #cbd5e1;
            border-radius: 0.2rem;
            background: white;
            padding: 1rem;
            margin-bottom: 1rem;
        }


        .execute-button {
            padding: 15px;
            margin-bottom: 0.5rem;
            border-radius: 0.2rem;
            border: none;
            color: white;
            background: rgb(25, 24, 24);
            cursor: pointer;
            width: 100%;
        }

        .function-button,
        .reset-button,
        .lock-button,
        .remove-button {
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border: 1px solid #cbd5e1;
            background: #f1f5f9;
            cursor: pointer;
            width: 100%;
        }

        .flex {
            display: flex;
            gap: 10px;
        }

        .step-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.25rem;
            background: #fff;
            margin-bottom: 0.5rem;
        }

        .status-box {
            background: #0f172a;
            color: #4ade80;
            font-family: monospace;
            padding: 1rem;
            border-radius: 0.5rem;
            white-space: pre-wrap;
            min-height: 6rem;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-robot"></i> Robot Control Dashboard</h1>
            <p>Configure and execute robot task sequences</p>
        </div>

        <div class="tabs-list">
            <div class="tabs-trigger active" onclick="switchTab('panel')">Task Panel</div>
            <div class="tabs-trigger" onclick="switchTab('feed')">Live Feed</div>
        </div>

        <div id="panel-tab">
            <div class="flex">
                <div class="card">
                    <h2>Available Functions</h2>
                    <p>Click any function to add it to your sequence</p>
                    <div id="function-list"></div>
                    <button class="reset-button" onclick="resetSequence()">Reset Sequence</button>
                </div>

                <div class="card">
                    <h2>Task Sequence</h2>
                    <div id="sequence-list"></div>
                    <button class="execute-button" onclick="executeSequence()">Start Execution</button>
                </div>
            </div>

            <h2>Robot Status</h2>
            <div id="status" class="status-box">Idle</div>
        </div>

        <div id="feed-tab" style="display: none">
            <h2>Live Camera Feed</h2>
            <video src="/video_feed" autoplay muted controls style="width: 100%; border-radius: 0.5rem"></video>
        </div>
    </div>

    <script>
        const availableFunctions = [
            { id: "do_pressRBR", name: "Press RBR", description: "Execute right button press sequence" },
            { id: "do_drawScreen", name: "Draw Screen", description: "Perform screen drawing operation" },
            { id: "do_Maze1", name: "Maze 1", description: "Navigate through maze pattern 1" },
            { id: "do_Maze2", name: "Maze 2", description: "Navigate through maze pattern 2" },
        ];

        let sequence = [];
        let isExecuting = false;
        const statusEl = document.getElementById("status");

        function switchTab(tab) {
            document.getElementById("panel-tab").style.display = tab === "panel" ? "block" : "none";
            document.getElementById("feed-tab").style.display = tab === "feed" ? "block" : "none";
            document.querySelectorAll(".tabs-trigger").forEach((el, idx) => {
                el.classList.toggle("active", (tab === "panel" && idx === 0) || (tab === "feed" && idx === 1));
            });
        }

        function renderFunctions() {
            const container = document.getElementById("function-list");
            container.innerHTML = "";
            availableFunctions.forEach((func) => {
                const btn = document.createElement("button");
                btn.className = "function-button";
                btn.textContent = `${func.name}: ${func.description}`;
                btn.onclick = () => addToSequence(func);
                container.appendChild(btn);
            });
        }

        function renderSequence() {
            const container = document.getElementById("sequence-list");
            container.innerHTML = "";
            sequence.forEach((step, i) => {
                const row = document.createElement("div");
                row.className = "step-row";
                row.innerHTML = `
          <span>${i + 1}. ${step.name}</span>
          <span class=flex>
            <button class="lock-button" onclick="toggleLock('${step.id}')">${step.locked ? "ðŸ”’" : "ðŸ”“"}</button>
            <button class="remove-button" onclick="removeFromSequence('${step.id}')" ${step.locked ? "disabled" : ""}>ðŸ—‘</button>
          </span>
        `;
                container.appendChild(row);
            });
        }

        function addToSequence(func) {
            const newStep = {
                id: func.id + "-" + Date.now(),
                functionId: func.id,
                name: func.name,
                locked: false,
            };
            sequence.push(newStep);
            renderSequence();
        }

        function removeFromSequence(id) {
            sequence = sequence.filter((step) => step.id !== id);
            renderSequence();
        }

        function toggleLock(id) {
            sequence = sequence.map((step) => (step.id === id ? { ...step, locked: !step.locked } : step));
            renderSequence();
        }

        function resetSequence() {
            sequence = [];
            statusEl.textContent = "Idle";
            renderSequence();
        }

        async function executeSequence() {
            if (sequence.length === 0 || isExecuting) return;
            isExecuting = true;
            statusEl.textContent = "ðŸš€ Executing sequence...";
            for (const step of sequence) {
                await new Promise((res) => setTimeout(res, 700));
                statusEl.textContent += `\nâœ“ ${step.name}`;
            }
            statusEl.textContent += "\nâœ… Sequence completed!";
            isExecuting = false;
        }

        renderFunctions();
        renderSequence();
    </script>
</body>

</html>